<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>D-FLIX PRO | Sidebar Fixed</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap');
    :root { --primary: #E50914; --bg: #050505; --card-bg: #121212; --side-close: 70px; --side-open: 240px; }
    
    body { background: var(--bg); color: white; font-family: 'Outfit', sans-serif; margin: 0; overflow: hidden; height: 100vh; }
    
    /* Global Reset to stop Zoom */
    * { box-sizing: border-box; outline: none !important; }

    /* --- SIDEBAR AUTO-HIDE & FIX --- */
    .tv-sidebar {
      position: fixed; left: 0; top: 0; bottom: 0; width: var(--side-close);
      background: rgba(0,0,0,0.98); display: none; flex-direction: column;
      z-index: 9999; border-right: 1px solid rgba(255,255,255,0.1);
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden; padding-top: 40px;
    }
    /* Expand on Focus or Hover */
    .tv-sidebar:hover, .tv-sidebar:focus-within { width: var(--side-open); box-shadow: 20px 0 50px rgba(0,0,0,0.9); }
    
    .side-item {
      color: #777; text-decoration: none; margin-bottom: 20px; width: 100%;
      display: flex; align-items: center; padding: 15px 22px; border: none; background: none; transition: 0.2s;
    }
    .side-item i { font-size: 1.6rem; min-width: 30px; text-align: center; }
    .side-item span { 
      opacity: 0; font-weight: 700; margin-left: 20px; white-space: nowrap; 
      transition: opacity 0.2s; visibility: hidden;
    }
    .tv-sidebar:hover span, .tv-sidebar:focus-within span { opacity: 1; visibility: visible; }
    
    .side-item:focus, .side-item.active { color: var(--primary); background: rgba(255,255,255,0.05); }

    /* --- MAIN WRAPPER --- */
    .main-content { 
      margin-left: 0; transition: margin-left 0.3s; height: 100vh; 
      overflow-y: auto; overflow-x: hidden; scroll-behavior: smooth;
    }

    /* --- HERO & GRID --- */
    .hero { height: 65vh; background-size: cover; background-position: center; display: flex; align-items: flex-end; padding: 40px 5%; position: relative; }
    .hero::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, var(--bg) 10%, transparent 90%); }
    
    .movie-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 20px 5%; }
    
    .m-card { 
      background: var(--card-bg); border-radius: 10px; overflow: hidden; 
      border: 3px solid transparent; transition: 0.2s; position: relative;
    }
    .m-card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
    
    /* NO-ZOOM FOCUS STYLE */
    .m-card:focus { border-color: white; z-index: 10; transform: none; box-shadow: 0 0 20px rgba(255,255,255,0.2); }

    /* --- RESPONSIVE LOGIC --- */
    @media (min-width: 992px) {
      .tv-sidebar { display: flex; }
      .main-content { margin-left: var(--side-close); }
      .movie-grid { grid-template-columns: repeat(5, 1fr); }
      .m-card img { aspect-ratio: 16/9; }
      .bottom-nav { display: none; }
      body { cursor: none; }
    }

    /* Mobile Bottom Nav */
    .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 12px; z-index: 5000; border-top: 1px solid #222; }
    .nav-btn { color: #666; background: none; border: none; font-size: 0.75rem; text-align: center; }
    .nav-btn.active { color: var(--primary); }
  </style>
</head>
<body onkeydown="handleRemote(event)">

  <nav class="tv-sidebar" id="sidebar">
    <div class="text-center mb-5 text-primary fw-bold" style="font-size: 1.5rem;">D</div>
    <button class="side-item active" onclick="navTo('home')" tabindex="0"><i class="fa-solid fa-house"></i><span>Home</span></button>
    <button class="side-item" onclick="navTo('search')" tabindex="0"><i class="fa-solid fa-search"></i><span>Search</span></button>
    <button class="side-item" onclick="navTo('cats')" tabindex="0"><i class="fa-solid fa-layer-group"></i><span>Categories</span></button>
    <button class="side-item" onclick="navTo('me')" tabindex="0"><i class="fa-solid fa-clock-rotate-left"></i><span>History</span></button>
  </nav>

  <div class="main-content" id="scroll-wrapper">
    <div id="scr-home" class="screen-view active">
      <div class="hero" id="hero-box" style="background-image: url('https://via.placeholder.com/1280x720')">
        <div style="z-index: 10;">
            <h1 id="hero-title" class="fw-bold display-4">D-FLIX</h1>
            <button class="btn btn-danger fw-bold px-5 mt-2" id="hero-play" tabindex="0">â–¶ PLAY</button>
        </div>
      </div>
      <div id="home-data"></div>
    </div>

    <div id="scr-search" class="screen-view" style="display:none; padding-top: 80px;">
        <div class="px-5"><input type="text" id="searchInput" class="form-control bg-dark text-white border-0 p-3" placeholder="Search..." oninput="runSearch()" tabindex="0">
        <div id="search-results" class="movie-grid"></div></div>
    </div>

    </div>

  <div class="bottom-nav">
    <button class="nav-btn active" onclick="navTo('home')"><i class="fa-solid fa-house fa-lg"></i><br>Home</button>
    <button class="nav-btn" onclick="navTo('search')"><i class="fa-solid fa-search fa-lg"></i><br>Search</button>
    <button class="nav-btn" onclick="navTo('me')"><i class="fa-solid fa-user fa-lg"></i><br>Me</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyATfDfJNk0lPVpcsZk7yj2p_DSdK9sQXvo",
      authDomain: "dflix-7b2d2.firebaseapp.com",
      projectId: "dflix-7b2d2",
      storageBucket: "dflix-7b2d2.appspot.com",
      messagingSenderId: "410654152125",
      appId: "1:410654152125:web:c55db9c81363abce66eed4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let masterData = [];

    window.navTo = (target) => {
        document.querySelectorAll('.screen-view').forEach(s => s.style.display = 'none');
        document.getElementById('scr-' + target).style.display = 'block';
        document.querySelectorAll('.side-item, .nav-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll(`[onclick="navTo('${target}')"]`).forEach(b => b.classList.add('active'));
    };

    onSnapshot(collection(db, "movies"), (snap) => {
      masterData = [];
      snap.forEach(doc => masterData.push(doc.data()));
      renderHome();
    });

    function createCard(m) {
      const card = document.createElement('div');
      card.className = "m-card"; card.tabIndex = "0";
      card.innerHTML = `<img src="${m.poster}">`;
      card.onclick = () => window.open(m.url, '_blank');
      card.onfocus = () => {
          document.getElementById('hero-box').style.backgroundImage = `url(${m.poster})`;
          document.getElementById('hero-title').innerText = m.title;
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
      };
      return card;
    }

    function renderHome() {
      const home = document.getElementById('home-data'); home.innerHTML = '';
      ['Hollywood', 'Web Series', 'Bollywood'].forEach(cat => {
          const list = masterData.filter(m => m.section === cat);
          if(list.length > 0) {
              home.insertAdjacentHTML('beforeend', `<h5 class="px-5 mt-4 fw-bold text-secondary">${cat}</h5>`);
              const grid = document.createElement('div'); grid.className = 'movie-grid';
              list.reverse().forEach(m => grid.appendChild(createCard(m)));
              home.appendChild(grid);
          }
      });
    }

    // --- SMART REMOTE CONTROL ---
    window.handleRemote = (e) => {
        const focusable = document.querySelectorAll('.m-card, .side-item, .nav-btn, input, button');
        let idx = Array.from(focusable).indexOf(document.activeElement);

        if (e.keyCode === 39 && idx < focusable.length - 1) focusable[idx+1].focus(); // Right
        if (e.keyCode === 37) { // Left
            if (idx > 0) focusable[idx-1].focus();
            if (document.activeElement.classList.contains('m-card')) {
                // Agar movie card par ho to Left dabane par sidebar par jao
                document.querySelector('.side-item.active').focus();
            }
        }
        if (e.keyCode === 40 && idx + 5 < focusable.length) focusable[idx+5].focus(); // Down
        if (e.keyCode === 38 && idx - 5 >= 0) focusable[idx-5].focus(); // Up
        if (e.keyCode === 13) document.activeElement.click(); // OK
    };

    window.runSearch = () => {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const res = document.getElementById('search-results'); res.innerHTML = '';
        masterData.filter(m => m.title.toLowerCase().includes(q)).forEach(m => res.appendChild(createCard(m)));
    };
  </script>
</body>
</html>
